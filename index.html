<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CROWSAINT | THE HOLY FALLEN</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Space+Mono&display=swap');
        
        /* CORE SETTINGS */
        * { cursor: none !important; }
        body { background-color: #000; color: #fff; font-family: 'Space Mono', monospace; overflow-x: hidden; }
        .header-font { font-family: 'Syncopate', sans-serif; }

        /* CUSTOM CURSOR */
        @media (pointer: coarse) { #cursor, #cursor-border { display: none !important; } * { cursor: auto !important; } }
        #cursor { position: fixed; z-index: 999999; pointer-events: none; mix-blend-mode: difference; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        #cursor svg { width: 35px; fill: white; animation: crowFlap 0.8s infinite alternate; }
        #cursor-border { position: fixed; width: 50px; height: 50px; border: 1px solid rgba(255,255,255,0.2); border-radius: 50%; pointer-events: none; z-index: 999998; mix-blend-mode: difference; transform: translate(-50%, -50%); transition: all 0.2s ease-out; }
        .cursor-hover #cursor svg { transform: scale(1.5); filter: drop-shadow(0 0 10px #fff); }
        @keyframes crowFlap { 0% { transform: translateY(0); } 100% { transform: translateY(-5px); } }

        /* PRELOADER STYLING (UPDATED) */
        #preloader { position: fixed; inset: 0; background: #000; z-index: 100000; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; }
        .bg-logo-spin { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 120vw; opacity: 0.05; animation: slowSpin 60s linear infinite; pointer-events: none; }
        @keyframes slowSpin { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
        .scanline { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.5) 50%); background-size: 100% 4px; pointer-events: none; z-index: 10; opacity: 0.3; }
        .hud-text { position: absolute; font-size: 8px; color: #333; letter-spacing: 2px; text-transform: uppercase; }

        .enter-btn { padding: 18px 36px; border: 1px solid #fff; font-size: 11px; letter-spacing: 5px; transition: all 0.5s; background: black; color: white; margin-top: 20px; position: relative; z-index: 20; }
        .enter-btn:hover { background: #fff; color: #000; box-shadow: 0 0 30px #fff; }
        
        /* AUTH UI */
        .auth-input { background: transparent; border: 1px solid #333; padding: 12px; width: 100%; color: white; font-size: 10px; outline: none; transition: 0.3s; margin-bottom: 10px; text-transform: uppercase; }
        .auth-input:focus { border-color: white; }
        .auth-link { color: #666; font-size: 9px; cursor: pointer; text-decoration: underline; margin-top: 10px; display: block; }
        .auth-link:hover { color: #fff; }

        /* SIDEBAR & NAV */
        #sidebar { transition: transform 0.5s cubic-bezier(0.77,0.2,0.05,1.0); z-index: 100001; }
        .menu-link { display: block; font-size: 1.1rem; margin-bottom: 1.2rem; transition: 0.3s; opacity: 0.5; position: relative; z-index: 100005; }
        .menu-link.active, .menu-link:hover { opacity: 1; padding-left: 10px; text-decoration: underline; text-underline-offset: 5px; }
        .top-nav { position: fixed; top: 40px; right: 40px; display: flex; align-items: center; gap: 15px; z-index: 99999; }
        .nav-box { background: rgba(0,0,0,0.4); backdrop-blur: md; border: 1px solid rgba(255,255,255,0.1); padding: 12px; display: flex; align-items: center; transition: 0.3s; }
        .nav-box:hover { border-color: #fff; }

        /* MODALS & FORMS */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 199999; display: none; }
        .modal-overlay.active { display: block; }
        .owner-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); background: #0a0a0a; border: 1px solid #fff; padding: 30px; z-index: 200000; width: 90%; max-width: 400px; display: none; }
        .owner-modal.active { display: block; transform: translate(-50%, -50%) scale(1); }
        .file-wrapper { border: 1px dashed #333; padding: 20px; text-align: center; cursor: pointer; font-size: 9px; color: #555; text-transform: uppercase; margin-bottom: 15px; }
        .file-wrapper:hover { border-color: #fff; color: #fff; }

        /* CONTENT ELEMENTS */
        .lore-container { width: 90%; max-width: 700px; margin: 0 auto; line-height: 2.2; text-align: justify; padding: 20px 0; }
        .lore-container p { margin-bottom: 30px; opacity: 0.7; font-size: 12px; letter-spacing: 0.5px; }
        .card-glow { transition: all 0.5s; border: 1px solid #18181b; position: relative; }
        .card-glow:hover { transform: translateY(-10px); border-color: #fff; box-shadow: 0 0 30px rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); }
        .delete-badge { position: absolute; top: 0; right: 0; background: #800; color: #fff; font-size: 8px; padding: 4px 8px; cursor: pointer; z-index: 50; }
        
        /* FAVORITE & PROFILE UI */
        .profile-pic { width: 40px; height: 40px; border: 1px solid #333; border-radius: 50%; object-fit: cover; }
        .rank-badge { font-size: 8px; background: #111; border: 1px solid #333; padding: 2px 6px; color: #888; margin-top: 4px; display: inline-block; }
        .fav-btn { position: absolute; top: 10px; left: 10px; z-index: 40; opacity: 0.5; transition: 0.3s; cursor: pointer; }
        .fav-btn:hover, .fav-btn.active { opacity: 1; color: #ff0000; transform: scale(1.2); }
    </style>
</head>
<body>

    <canvas id="starfield" class="fixed inset-0 z-[-1]"></canvas>

    <div id="preloader">
        <img src="logo.png" class="bg-logo-spin">
        <div class="scanline"></div>
        <div class="hud-text top-5 left-5">SYS.SECURE_CONNECTION</div>
        <div class="hud-text top-5 right-5">ENCRYPTED</div>
        <div class="hud-text bottom-5 left-5">V.6.0.2026</div>
        <div class="hud-text bottom-5 right-5">ARCHIVE_READY</div>

        <div id="welcome-screen" class="flex flex-col items-center relative z-20">
            <div class="header-font text-[14px] tracking-[1.5em] mb-4 text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">CROWSAINT</div>
            <div class="text-[8px] tracking-[0.5em] text-zinc-500 mb-8">THE HOLY FALLEN ARCHIVE</div>
            <button onclick="showLogin()" class="enter-btn header-font btn-hover">ENTER ARCHIVE</button>
        </div>
        
        <div id="login-screen" class="hidden w-72 text-center relative z-20">
            <h3 class="header-font text-[10px] tracking-[0.5em] mb-8 text-white">IDENTIFY YOURSELF</h3>
            <input type="text" id="login-user" placeholder="USERNAME" class="auth-input">
            <input type="password" id="login-pass" placeholder="PASSWORD" class="auth-input">
            <button onclick="handleLogin()" class="enter-btn w-full header-font btn-hover">ACCESS</button>
            <span onclick="showRegister()" class="auth-link">NO IDENTITY? CREATE ACCOUNT</span>
        </div>
        
        <div id="register-screen" class="hidden w-72 text-center relative z-20">
            <h3 class="header-font text-[10px] tracking-[0.5em] mb-8 text-white">NEW IDENTITY</h3>
            <input type="text" id="reg-user" placeholder="USERNAME" class="auth-input">
            <input type="password" id="reg-pass" placeholder="PASSWORD" class="auth-input">
            <input type="password" id="reg-pass-conf" placeholder="CONFIRM PASSWORD" class="auth-input">
            <button onclick="handleRegister()" class="enter-btn w-full header-font btn-hover">REGISTER</button>
            <span onclick="showLogin()" class="auth-link">RETURN TO LOGIN</span>
        </div>
        
        <div id="loading-status" class="hidden flex flex-col items-center mt-10 relative z-20">
            <div class="text-[8px] tracking-[0.5em] text-white uppercase mb-4">AUTHENTICATED. DECRYPTING...</div>
            <div class="w-64 h-[1px] bg-zinc-900 overflow-hidden relative"><div id="progress-bar" class="w-0 h-full bg-white transition-all duration-300"></div></div>
            <div id="progress-percent" class="mt-4 text-[7px] text-zinc-500 font-mono">0%</div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()"></div>

    <div id="owner-modal" class="owner-modal">
        <h3 class="header-font text-[10px] mb-6 tracking-widest text-center">OWNER TERMINAL</h3>
        <div class="file-wrapper" onclick="document.getElementById('file-upload').click()">
            <span id="file-name-display">SELECT IMAGE</span>
            <input type="file" id="file-upload" class="hidden" accept="image/*" onchange="handleFileSelect(this)">
        </div>
        <input type="text" id="new-name" placeholder="PRODUCT NAME" class="auth-input">
        <input type="text" id="new-link" placeholder="ROBLOX LINK" class="auth-input">
        <button onclick="saveNewProduct()" class="enter-btn w-full mt-0 header-font btn-hover">PUSH</button>
    </div>

    <div id="admin-modal" class="owner-modal">
        <h3 class="header-font text-[10px] mb-6 tracking-widest text-center text-red-500">ADMIN RECRUITMENT</h3>
        <input type="text" id="adm-nama" placeholder="REAL NAME" class="auth-input">
        <input type="text" id="adm-roblox" placeholder="ROBLOX USERNAME" class="auth-input">
        <textarea id="adm-alasan" rows="2" placeholder="WHY YOU?" class="auth-input"></textarea>
        <textarea id="adm-misi" rows="2" placeholder="YOUR MISSION?" class="auth-input"></textarea>
        <button onclick="kirimAdminForm()" id="btn-adm" class="enter-btn w-full mt-0 header-font btn-hover">SEND APPLICATION</button>
    </div>
    <div id="leaderboard-modal" class="owner-modal" style="max-width: 500px;">
        <h3 class="header-font text-[10px] mb-6 tracking-widest text-center text-white">THE HOLY ARCHIVE RANKING</h3>
        <div id="leaderboard-content" class="space-y-4 max-h-[400px] overflow-y-auto pr-2 text-white">
            </div>
        <button onclick="closeAllModals()" class="enter-btn w-full mt-6 header-font text-[8px]">CLOSE</button>
    </div>

    <div id="profile-modal" class="owner-modal">
        <h3 class="header-font text-[10px] mb-6 tracking-widest text-center">EDIT IDENTITY</h3>
        <div class="file-wrapper" onclick="document.getElementById('profile-upload').click()">
            <span id="profile-file-display">SELECT PROFILE IMAGE</span>
            <input type="file" id="profile-upload" class="hidden" accept="image/*" onchange="handleProfileFileSelect(this)">
        </div>
        <div class="text-[8px] text-zinc-500 mb-2 mt-4 uppercase">Select Rank:</div>
        <select id="edit-rank" class="auth-input bg-black">
            <option value="SAINT INITIATE">SAINT INITIATE</option>
            <option value="VOID WALKER">VOID WALKER</option>
            <option value="SHADOW GUARD">SHADOW GUARD</option>-
        </select>
        <button onclick="saveProfile()" class="enter-btn w-full mt-4 header-font btn-hover">UPDATE</button>
    </div>

    <div class="top-nav hidden" id="main-nav">
        <div class="nav-box btn-hover" id="search-ui" style="display:none">
            <input type="text" id="search-bar" onkeyup="handleSearch()" placeholder="SEARCH..." class="bg-transparent outline-none text-[10px] w-32 uppercase text-white">
        </div>
        <a href="https://www.roblox.com/share/g/651113905" target="_blank" class="nav-box btn-hover bg-white/5 border-white/20 uppercase">
            <span class="text-[9px] header-font">JOIN GROUP</span>
        </a>
    </div>

    <button id="sidebar-toggle" onclick="toggleSidebar()" class="hidden fixed top-10 left-10 z-[100002] bg-black/50 p-3 border border-white/10 uppercase text-[10px] header-font btn-hover">MENU</button>

    <div id="sidebar" class="fixed top-0 left-0 h-full w-80 bg-zinc-950 border-r border-zinc-900 p-10 flex flex-col transform -translate-x-full overflow-y-auto">
        <button onclick="toggleSidebar()" class="self-end text-zinc-500 hover:text-white uppercase text-[10px] btn-hover mb-8">CLOSE</button>
        
        <nav class="space-y-1 mb-8">
            <h4 class="text-[9px] text-zinc-600 tracking-widest mb-6 mt-4">ARCHIVE</h4>
            <button onclick="switchTab('home')" id="home-tab" class="menu-link header-font btn-hover active uppercase">HOME</button>
            <button onclick="switchTab('shop')" id="shop-tab" class="menu-link header-font btn-hover uppercase">SHOP</button>
            <button onclick="switchTab('favorites')" id="fav-tab" class="menu-link header-font btn-hover uppercase text-red-400">FAVORITES</button>
            
            <h4 class="text-[9px] text-zinc-600 tracking-widest mt-10 mb-6">COMMUNITY</h4>
            <a href="https://discord.gg/4KtcGzm7t" target="_blank" class="menu-link header-font btn-hover uppercase">DISCORD</a>
            <a href="https://www.tiktok.com/@ferdi_wp3" target="_blank" class="menu-link header-font btn-hover uppercase">TIKTOK</a>
            <a href="https://www.roblox.com/id/users/7034402955/profile" target="_blank" class="menu-link header-font btn-hover uppercase">ROBLOX PROFILE</a>
            <a href="https://www.roblox.com/share/g/651113905" target="_blank" class="menu-link header-font btn-hover uppercase text-white/80">ROBLOX GROUP</a>
            <button onclick="openAdminModal()" class="menu-link header-font btn-hover uppercase text-red-500 mt-6 text-[10px]">APPLY ADMIN</button>
            <button onclick="checkOwner()" class="block text-[9px] text-zinc-800 hover:text-zinc-500 mt-10 uppercase italic btn-hover">[ OWNER ACCESS ]</button>
        </nav>

        <div class="mt-auto">
            <div class="border-t border-zinc-900 pt-6 pb-6">
                <h4 class="text-[9px] text-zinc-600 tracking-widest mb-4 uppercase">IDENTITY</h4>
                <div class="flex items-center gap-3">
                    <img id="sidebar-pic" src="https://via.placeholder.com/150" class="profile-pic">
                    <div>
                        <div id="current-user-display" class="text-[10px] font-bold uppercase text-white">GUEST</div>
                        <div id="current-rank-display" class="rank-badge">UNVERIFIED</div>
                    </div>
                </div>
                <button onclick="openProfileModal()" class="text-[8px] text-zinc-500 hover:text-white underline mt-3 uppercase btn-hover">EDIT PROFILE</button>
            </div>

            <div class="border-t border-zinc-900 pt-6">
                <h4 class="text-[9px] text-zinc-600 tracking-widest mb-4 uppercase">FEEDBACK</h4>
                <div class="space-y-3">
                    <input type="text" id="nama-saran" placeholder="NAME..." class="auth-input" style="font-size: 9px; padding: 8px;">
                    <textarea id="pesan-saran" rows="2" placeholder="MESSAGE..." class="auth-input" style="font-size: 9px; padding: 8px;"></textarea>
                    <button onclick="kirimSaran()" id="btn-saran" class="w-full py-2 border border-white/20 text-[9px] header-font hover:bg-white hover:text-black btn-hover">SEND</button>
                </div>
                
                <div class="flex gap-2 mt-6">
                    <button onclick="toggleAudio()" id="audio-btn" class="text-[9px] text-zinc-400 hover:text-white uppercase flex-1 border border-zinc-800 py-1 btn-hover">MUTE</button>
                   <button onclick="showLoginHistory()" class="text-[9px] text-zinc-400 hover:text-white uppercase w-full border border-zinc-800 py-1 mb-2 btn-hover">LOGIN HISTORY</button>
                    <button onclick="showLeaderboard()" class="text-[9px] text-zinc-400 hover:text-white uppercase w-full border border-zinc-800 py-1 mb-2 btn-hover">GLOBAL RANKING</button>
                    <button onclick="handleLogout()" class="text-[9px] text-red-800 hover:text-red-500 uppercase flex-1 border border-red-900/30 py-1 btn-hover">LOGOUT</button>
                </div>
            </div>
        </div>
    </div>

    <header class="text-center pt-40 md:pt-60 mb-10 px-6 reveal relative">
        <img src="logo.png" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 md:w-[500px] opacity-20 pointer-events-none z-[-1]" alt="CROWSAINT LOGO">
        
        <h1 class="header-font text-5xl md:text-8xl tracking-tighter mb-4 text-white">CROWSAINT</h1>
        <p class="text-zinc-600 text-[8px] md:text-[10px] tracking-[0.5em] uppercase italic">"Don't follow the crowd, lead the saint"</p>
    </header>

    <main class="mb-32">
        <section id="home-section" class="reveal">
            <div class="lore-container">
                <p>Dia tidak berasal dari tanah yang kau pijak. Di antara konstelasi yang belum terpetakan, ia adalah Sang Penjaga—seorang Kesatria Gagak Suci yang sayapnya menyentuh batas cakrawala abadi.</p>
                <p>Namun, cahaya kesucian tak selamanya abadi. Dalam sebuah prahara langit, Sang Kesatria dikhianati. Ia dijatuhkan, terlempar menembus atmosfer dengan api yang membakar jubah putihnya menjadi hitam sekelam malam.</p>
                <p>Kini, Sang Gagak mendarat di bumi. Ia membangun 'Archive'—sebuah tempat bagi mereka yang memimpin kegelapan dengan martabat seorang suci.</p>
                <p class="text-center italic mt-16 tracking-[0.4em] text-[10px] text-white border-y border-white/10 py-8">"I AM THE SAINT OF THE VOID. WELCOME TO MY ARCHIVE."</p>
            </div>
        </section>

        <section id="shop-section" class="hidden px-4 md:px-20">
            <div id="fav-header" class="hidden text-center mb-10">
                <h2 class="header-font text-xl text-red-500">YOUR FAVORITES</h2>
                <div class="w-20 h-[1px] bg-red-900 mx-auto mt-2"></div>
            </div>
            <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </section>
    </main>

    <div class="fixed bottom-5 left-5 text-[9px] text-zinc-500 font-mono tracking-widest hidden md:block">
        <div id="digital-clock" class="text-white">00:00:00</div>
        <div class="text-white/30 uppercase italic mt-1">Status: Operational</div>
    </div>

    <div id="cursor"><svg viewBox="0 0 24 24"><path d="M23.6 3c-1 .5-2.2 1-3.3 1.2 1.2-.8 2-2 2.5-3.5-1 .8-2.3 1.4-3.7 1.7C18 1.3 16.5 0 14.7 0c-3.3 0-6 2.7-6 6v1.5C5 7 2 4.5.5 1.5 0 2.2-.3 3-.3 4 1 6.5 2.5 8 5 9c-1-.2-2-.5-2.8-1-.2 2 1.3 4 3.5 5-1 .2-1.8.3-2.8.2.8 2 3 3.3 5.5 3.3-2.2 1.8-5 2.8-8 2.8H0c2.8 1.8 6.2 2.8 9.8 2.8 11.8 0 18.3-9.8 18.3-18.3 0-.3 0-.5-.2-.8 1.3-1 2.3-2.2 3.2-3.5z"/></svg></div>
    <div id="cursor-border"></div>
    <audio id="bg-music" loop><source src="horror.mp3" type="audio/mpeg"></audio>

    <script>
        const audio = document.getElementById('bg-music');
        let localProducts = JSON.parse(localStorage.getItem('crowsaint_items')) || [];
        let favorites = JSON.parse(localStorage.getItem('crowsaint_favs')) || [];
        let tempImgUrl = "";
        let tempProfileImgUrl = ""; 
        let currentUser = null;
        let currentTab = 'home';
        
        const initialProducts = [
            { id: 1, name: "DARK ANGEL", link: "https://www.roblox.com/id/catalog/112826960972224/", img: "1.jpg" },
            { id: 2, name: "PIXEL KNIGHT", link: "https://www.roblox.com/id/catalog/124309605398103/", img: "2.jpg" },
            { id: 3, name: "TRUE SPIRIT", link: "https://www.roblox.com/id/catalog/75655921151654/", img: "3.jpg" },
            { id: 4, name: "SKELETON VINTAGE", link: "https://www.roblox.com/id/catalog/132636175212887/", img: "4.jpg" },
            { id: 5, name: "CRIMSON TACTICAL", link: "https://www.roblox.com/id/catalog/110975831284516/", img: "5.jpg" },
            { id: 6, name: "ROYAL GOTH", link: "https://www.roblox.com/id/catalog/116830912569538/", img: "6.jpg" },
            { id: 7, name: "SHIBUYA RAVEN", link: "https://www.roblox.com/id/catalog/92039399309120/", img: "7.jpg" },
            { id: 8, name: "VOID STARE", link: "https://www.roblox.com/id/catalog/103938443054749/", img: "8.jpg" },
            { id: 9, name: "4TUNE TRACKSUIT", link: "https://www.roblox.com/id/catalog/98632374215258/", img: "9.jpg" },
            { id: 10,name: "VOID GUARDIAN", link: "https://www.roblox.com/id/catalog/100455808788629/", img: "10.jpg" }
        ];

        // --- AUTH & LOAD ---
        function showLogin() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            if(audio.paused) { audio.volume = 1.0; audio.play().catch(e => console.log("Audio permission needed")); }
        }
        function showRegister() { document.getElementById('login-screen').classList.add('hidden'); document.getElementById('register-screen').classList.remove('hidden'); }
            async function handleRegister() {
        const user = document.getElementById('reg-user').value.toUpperCase().trim();
        const pass = document.getElementById('reg-pass').value;
        const conf = document.getElementById('reg-pass-conf').value;

        if(!user || !pass || !conf) return alert("EMPTY FIELDS.");
        if(pass !== conf) return alert("PASSWORD MISMATCH.");

        // Kirim data ke tabel 'users' di Supabase
        const { error } = await supabaseClient
            .from('leaderboard') // Kita pake tabel yang sama tapi tambahin kolom password
            .upsert({ 
                username: user, 
                password: pass, // PASTIIN DI SUPABASE SUDAH ADA KOLOM 'password' (Type: text)
                pic: "logo.png",
                rank: "SAINT INITIATE",
                points: 0
            });

    if (error) return alert("REGISTER FAILED: " + error.message);
    alert("IDENTITY ESTABLISHED IN THE CLOUD.");
    showLogin();
}
        function handleLogin() {
            const user = document.getElementById('login-user').value.toUpperCase().trim();
            const pass = document.getElementById('login-pass').value;
            let users = JSON.parse(localStorage.getItem('crowsaint_users')) || [];
            const foundUser = users.find(u => u.username === user && u.password === pass);
            if(foundUser) { currentUser = foundUser; updateProfileUI(); startLoading(); } 
            else { alert("ACCESS DENIED: INVALID CREDENTIALS."); }
        }
        function handleLogout() {
            if(confirm("LOGOUT FROM ARCHIVE?")) {
                currentUser = null;
                location.reload(); // Ini yang bikin halaman balik ke awal
            }
        }
        function startLoading() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('loading-status').classList.remove('hidden');
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.floor(Math.random() * 10) + 1;
                if (progress > 100) progress = 100;
                document.getElementById('progress-bar').style.width = progress + '%';
                document.getElementById('progress-percent').innerText = progress + '%';
                if(progress >= 100) { 
                    clearInterval(interval); document.getElementById('preloader').style.display = 'none';
                    document.getElementById('main-nav').classList.remove('hidden'); document.getElementById('sidebar-toggle').classList.remove('hidden');
                    ScrollReveal().reveal('.reveal', { distance: '20px', duration: 800, interval: 100 });
                }
            }, 80);
        }
        async function handleLogin() {
    const user = document.getElementById('login-user').value.toUpperCase().trim();
    const pass = document.getElementById('login-pass').value;

    console.log("LOGGING IN AS:", user); // DEBUG

    const { data: foundUser, error } = await supabaseClient
        .from('leaderboard')
        .select('*')
        .eq('username', user)
        .eq('password', pass)
        .single();

    if (error) {
        console.error("SUPABASE ERROR:", error.message);
        alert("ACCESS DENIED: " + error.message); 
        return;
    }

    if (foundUser) { 
        currentUser = foundUser; 
        
        // Simpan ke LocalStorage juga biar sidebar dapet data
        localStorage.setItem('crowsaint_current_user', JSON.stringify(foundUser));
        
        saveLoginLog(user); 
        updateProfileUI(); 
        startLoading(); 
    } else { 
        alert("ACCESS DENIED: IDENTITY NOT FOUND."); 
    }
}

        // --- PROFILE SYSTEM ---
        function updateProfileUI() {
            if(!currentUser) return;
            document.getElementById('current-user-display').innerText = currentUser.username;
            document.getElementById('current-rank-display').innerText = currentUser.rank;
            document.getElementById('sidebar-pic').src = currentUser.pic;
        }
        // ISI PAKAI DATA DARI FOTO SUPABASE LO
        const supabaseUrl = 'https://jsvddqdqczdfozxzjjso.supabase.co'; 
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzdmRkcWRxY3pkZm96eHpqanNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3Mzc4OTQsImV4cCI6MjA4NDMxMzg5NH0.4_RmWTcfd-PNKAyzae1xtmJQF5cZYDQQw__xQPw6l7g'; // Cari kode panjang di bawah URL tadi
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        function openProfileModal() { closeAllModals(); document.getElementById('profile-modal').classList.add('active'); document.getElementById('modal-overlay').classList.add('active'); }
        setInterval(async () => {
    if (currentUser) {
        const { data } = await supabaseClient.from('leaderboard').select('points').eq('username', currentUser.username).single();
        let currentPts = (data ? data.points : 0) + 1;

        await supabaseClient.from('leaderboard').upsert({ 
            username: currentUser.username, 
            points: currentPts,
            pic: currentUser.pic || '',
            rank: currentUser.rank || 'SAINT INITIATE'
        });
        }
}, 300000); // 5 menit sekali poin naik
        function handleProfileFileSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { 
                    tempProfileImgUrl = e.target.result; 
                    document.getElementById('profile-file-display').innerText = "IMAGE SELECTED"; 
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

       function saveProfile() {
            const newRank = document.getElementById('edit-rank').value;
            let users = JSON.parse(localStorage.getItem('crowsaint_users')) || [];
            let index = users.findIndex(u => u.username === currentUser.username);
            
            if(index !== -1) {
                // --- SISTEM KEAMANAN RANK ADMIN ---
                if (newRank === "SHADOW GUARD") {
                    const secretKey = prompt("ENTER SHADOW KEY TO ASCEND:");
                    if (secretKey !== "admin123") {
                        alert("ACCESS DENIED: YOU ARE NOT WORTHY OF THE SHADOWS.");
                        return; // Berhenti, rank nggak bakal berubah
                    }
                }

                // Update Gambar kalau ada yang dipilih
                if(tempProfileImgUrl) { 
                    users[index].pic = tempProfileImgUrl; 
                }
                
                // Update Rank secara permanen
                users[index].rank = newRank;
                
                // Simpan ke database lokal browser
                localStorage.setItem('crowsaint_users', JSON.stringify(users));
                
                // Update status user yang lagi login sekarang
                currentUser = users[index];
                
                // Reset form
                tempProfileImgUrl = ""; 
                document.getElementById('profile-file-display').innerText = "SELECT PROFILE IMAGE";
                
                // Refresh tampilan UI di sidebar
                updateProfileUI(); 
                closeAllModals(); 
                alert("IDENTITY UPDATED: RANK ASCENDED.");
            }
        }

        // --- FAVORITES SYSTEM ---
        function toggleFavorite(id) {
            if(favorites.includes(id)) { favorites = favorites.filter(fid => fid !== id); } 
            else { favorites.push(id); }
            localStorage.setItem('crowsaint_favs', JSON.stringify(favorites));
            renderProducts();
        }

        // --- NAVIGATION & RENDER ---
        function toggleSidebar() { 
            const sb = document.getElementById('sidebar'), btn = document.getElementById('sidebar-toggle');
            sb.classList.toggle('-translate-x-full'); 
            if(sb.classList.contains('-translate-x-full')) btn.classList.remove('hidden'); else btn.classList.add('hidden');
        }

        function switchTab(tab) {
            currentTab = tab;
            const home = document.getElementById('home-section');
            const shop = document.getElementById('shop-section');
            const search = document.getElementById('search-ui');
            const favHeader = document.getElementById('fav-header');
            
            ['home-tab', 'shop-tab', 'fav-tab'].forEach(id => document.getElementById(id).classList.remove('active'));

            if(tab === 'home') {
                home.classList.remove('hidden'); shop.classList.add('hidden'); search.style.display = 'none';
                document.getElementById('home-tab').classList.add('active');
            } else if (tab === 'shop') {
                home.classList.add('hidden'); shop.classList.remove('hidden'); search.style.display = 'flex';
                favHeader.classList.add('hidden'); 
                document.getElementById('shop-tab').classList.add('active');
                renderProducts();
            } else if (tab === 'favorites') {
                home.classList.add('hidden'); shop.classList.remove('hidden'); search.style.display = 'flex';
                favHeader.classList.remove('hidden'); 
                document.getElementById('fav-tab').classList.add('active');
                renderProducts();
            }
            document.getElementById('sidebar').classList.add('-translate-x-full'); document.getElementById('sidebar-toggle').classList.remove('hidden');
        }

        function renderProducts() {
            const allProducts = [...initialProducts, ...localProducts];
            const q = document.getElementById('search-bar').value.toUpperCase();
            
            let displayProducts = allProducts;
            if(currentTab === 'favorites') { displayProducts = allProducts.filter(p => favorites.includes(p.id)); }
            displayProducts = displayProducts.filter(p => p.name.includes(q));
            
            const grid = document.getElementById('product-grid');
            if(displayProducts.length === 0) { grid.innerHTML = `<div class="col-span-full text-center text-zinc-600 text-[10px] mt-10">NO ARTIFACTS FOUND.</div>`; return; }

            grid.innerHTML = displayProducts.map(p => {
                const isFav = favorites.includes(p.id);
                return `
                <div class="card-glow reveal p-3 md:p-5 bg-black/40 backdrop-blur-sm relative">
                    ${p.isLocal ? `<div class="delete-badge" onclick="deleteProduct(${p.id})">DEL</div>` : ''}
                    <div class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite(${p.id})">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="${isFav ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                    </div>
                    <div class="aspect-square bg-zinc-950 mb-4 flex items-center justify-center overflow-hidden border border-zinc-900 group">
                        <img src="${p.img}" class="w-full h-full object-contain group-hover:scale-110 transition duration-500">
                    </div>
                    <div class="flex flex-col gap-2">
                        <h3 class="header-font text-[9px] uppercase truncate w-full text-zinc-300">${p.name}</h3>
                        <a href="${p.link}" target="_blank" class="w-full text-center py-1 border border-zinc-800 hover:bg-white hover:text-black hover:border-white text-[8px] btn-hover uppercase transition-colors">PURCHASE</a>
                    </div>
                </div>`}).join('');
            attachCursorEvents();
        }

        // --- ADMIN & DATA ---
        function openAdminModal() { toggleSidebar(); document.getElementById('admin-modal').classList.add('active'); document.getElementById('modal-overlay').classList.add('active'); }
        async function kirimAdminForm() {
            const n=document.getElementById('adm-nama').value, r=document.getElementById('adm-roblox').value, a=document.getElementById('adm-alasan').value, m=document.getElementById('adm-misi').value;
            if(!n||!r||!a||!m) return alert("EMPTY.");
            try { await fetch("https://discord.com/api/webhooks/1462290709179793408/NefcPlviJPdzjwBZ9BeT_Bs7M5E0jORLBc_TKiq45vF5jiZxR0m__deOUpu7exskxSan", { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username: "ADMIN APP", embeds: [{title:"NEW APP", fields:[{name:"NAME",value:n},{name:"ROBLOX",value:r},{name:"REASON",value:a},{name:"MISSION",value:m}]}]}) }); closeAllModals(); alert("SENT."); } catch(e){alert("ERR");}
        }
        async function kirimSaran() {
            const n=document.getElementById('nama-saran').value, p=document.getElementById('pesan-saran').value; if(!n||!p)return alert("EMPTY");
            try { await fetch("https://discord.com/api/webhooks/1462290709179793408/NefcPlviJPdzjwBZ9BeT_Bs7M5E0jORLBc_TKiq45vF5jiZxR0m__deOUpu7exskxSan", { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username: "FEEDBACK", embeds: [{title:"MSG", fields:[{name:"SENDER",value:n},{name:"TEXT",value:p}]}]}) }); alert("SENT."); document.getElementById('nama-saran').value=""; document.getElementById('pesan-saran').value=""; } catch(e){alert("ERR");}
        }
        function checkOwner() { if(prompt("ACCESS KEY:") === "admin123") { document.getElementById('owner-modal').classList.add('active'); document.getElementById('modal-overlay').classList.add('active'); } else { alert("DENIED."); } }
        function handleFileSelect(input) { if (input.files[0]) { const r = new FileReader(); r.onload = (e) => { tempImgUrl = e.target.result; document.getElementById('file-name-display').innerText = "READY"; }; r.readAsDataURL(input.files[0]); } }
        function saveNewProduct() { const n=document.getElementById('new-name').value, l=document.getElementById('new-link').value; if(!tempImgUrl||!n||!l) return alert("EMPTY"); localProducts.push({id:Date.now(), name:n.toUpperCase(), link:l, img:tempImgUrl, isLocal:true}); localStorage.setItem('crowsaint_items', JSON.stringify(localProducts)); renderProducts(); closeAllModals(); }
        function deleteProduct(id) { if(confirm("DELETE?")) { localProducts = localProducts.filter(p=>p.id!==id); localStorage.setItem('crowsaint_items', JSON.stringify(localProducts)); renderProducts(); } }
        function closeAllModals() { document.querySelectorAll('.owner-modal').forEach(m => m.classList.remove('active')); document.getElementById('modal-overlay').classList.remove('active'); }
        function handleSearch() { renderProducts(); }
        function toggleAudio() { const btn = document.getElementById('audio-btn'); if(audio.paused) { audio.play(); btn.innerText = "MUTE"; } else { audio.pause(); btn.innerText = "UNMUTE"; } }

        // --- UTILS ---
        const cursor = document.getElementById('cursor'), border = document.getElementById('cursor-border');
        document.addEventListener('mousemove', (e) => { cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px'; border.style.left = e.clientX + 'px'; border.style.top = e.clientY + 'px'; });
        function attachCursorEvents() { document.querySelectorAll('a, button, input, textarea, .file-wrapper, .delete-badge, .auth-link, .fav-btn').forEach(el => { el.addEventListener('mouseenter', () => document.body.classList.add('cursor-hover')); el.addEventListener('mouseleave', () => document.body.classList.remove('cursor-hover')); }); }
        
        const canvas = document.getElementById('starfield'), ctx = canvas.getContext('2d');
        function initStars() { canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
        let stars = Array.from({length:80},()=>({x:Math.random()*2000,y:Math.random()*2000,s:Math.random()*1.5}));
        function draw() { ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle="#fff"; stars.forEach(s=>{ctx.beginPath();ctx.arc(s.x,s.y,s.s,0,7);ctx.fill();s.y+=0.2;if(s.y>canvas.height)s.y=0}); requestAnimationFrame(draw); }
        window.onresize=initStars; initStars(); draw(); setInterval(()=>{const n=new Date(); document.getElementById('digital-clock').innerText=n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0')+":"+n.getSeconds().toString().padStart(2,'0')},1000);
        renderProducts(); ScrollReveal().reveal('.reveal',{distance:'20px',duration:800});
        // MESIN PENCATAT LOGIN
        function saveLoginLog(username) {
            let logs = JSON.parse(localStorage.getItem('crowsaint_login_logs')) || [];
            const newLog = {
                user: username,
                time: new Date().toLocaleString('id-ID')
            };
            logs.unshift(newLog); // Simpan yang terbaru di paling atas
            if(logs.length > 10) logs.pop(); // Simpan 10 riwayat terakhir aja biar gak penuh
            localStorage.setItem('crowsaint_login_logs', JSON.stringify(logs));
        }

        // FUNGSI MENAMPILKAN RIWAYAT
        function showLoginHistory() {
            let logs = JSON.parse(localStorage.getItem('crowsaint_login_logs')) || [];
            if(logs.length === 0) return alert("NO LOGIN HISTORY FOUND.");
            
            let logString = "--- CROWSAINT LOGIN HISTORY ---\n\n";
            logs.forEach((log, i) => {
                logString += `${i+1}. ${log.user} | ${log.time}\n`;
            });
            alert(logString);
        }
        async function showLeaderboard() {
            closeAllModals();
            const modal = document.getElementById('leaderboard-modal');
            const content = document.getElementById('leaderboard-content');
            content.innerHTML = `<div class="text-[8px] text-center py-10 animate-pulse">DECRYPTING GLOBAL ARCHIVE...</div>`;
            modal.classList.add('active');
            document.getElementById('modal-overlay').classList.add('active');

            try {
                // Tarik 10 besar dari Supabase
                const { data: users, error } = await supabaseClient
                    .from('leaderboard')
                    .select('*')
                    .order('points', { ascending: false })
                    .limit(10);

                if (error) throw error;

                let html = `<div class="mb-4">
                                <p class="text-[7px] text-zinc-500 mb-2 uppercase tracking-[0.3em]">-- Archive Owner --</p>
                                <div class="flex items-center gap-3 bg-white/5 p-2 border border-white/20">
                                    <img src="logo.png" class="w-8 h-8 rounded-full border border-white/50 object-cover">
                                    <div>
                                        <p class="text-[10px] font-bold text-white uppercase">FERDI [OWNER]</p>
                                        <p class="text-[7px] text-zinc-500 uppercase">THE VOID GUARDIAN</p>
                                    </div>
                                </div>
                            </div>
                            <p class="text-[7px] text-zinc-500 mb-2 uppercase tracking-[0.3em]">-- Global Visitors --</p>`;

                users.forEach((u, i) => {
                    html += `
                    <div class="flex items-center justify-between bg-zinc-900/50 p-2 border border-zinc-800 mb-2">
                        <div class="flex items-center gap-3">
                            <span class="text-[10px] ${i < 3 ? 'text-white font-bold' : 'text-zinc-600'}">#${i + 1}</span>
                            <img src="${u.pic}" class="w-8 h-8 rounded-full border border-zinc-700 object-cover" onerror="this.src='logo.png'">
                            <div>
                                <p class="text-[10px] uppercase font-bold text-white">${u.username}</p>
                                <p class="text-[7px] text-zinc-500 uppercase">${u.rank}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-mono text-white">${u.points}</p>
                            <p class="text-[6px] text-zinc-600 uppercase">PTS</p>
                        </div>
                    </div>`;
                });
                content.innerHTML = html;
            } catch (e) {
                content.innerHTML = `<div class="text-red-500 text-[8px] text-center">FAILED TO LOAD GLOBAL DATA.</div>`;
            }
        }
    </script>jk
</body>
</html>
